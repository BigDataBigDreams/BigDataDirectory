// Generated by CoffeeScript 1.6.3
(function() {
  var OR_USE_MODEL, OR_USE_STARS, SELECT_MODEL, addNewAppliance, findAjax, findBrand, phps, showBrands;

  SELECT_MODEL = "Search for model";

  OR_USE_STARS = "or use stars";

  OR_USE_MODEL = "or search model";

  phps = 'resources/main/load';

  findAjax = function(type, obj, call) {
    return $.post(phps + type + '.php', obj, call);
  };

  window.getTable = function(row) {
    return $(row).find('select').val();
  };

  findBrand = function(row) {
    return findAjax('Brands', {
      'tableName': getTable(row),
      'brand': like
    }, function(brands) {
      return showBrands(row, brands);
    });
  };

  window.nearestStar = function(stars, row) {
    return findAjax('ByStar', {
      'tableName': getTable(row),
      'star': stars
    }, function(res) {
      return console.log(res);
    });
  };

  showBrands = function(row, brands) {};

  window.modelInput = function() {
    return $('<input>').addClass('model').attr({
      type: 'text',
      value: SELECT_MODEL
    }).focusin(function() {
      if (this.value === SELECT_MODEL) {
        return this.value = "";
      }
    }).focusout(function() {
      if (!this.value) {
        return this.value = SELECT_MODEL;
      }
    }).keyup(function() {
      return findBrands($(this).parents('tr'));
    });
  };

  window.getStarInput = function() {
    var j, stars, starspan, _fn, _i;
    starspan = $('<span>').addClass('stars');
    stars = [];
    _fn = function() {
      var lj;
      lj = j;
      return stars.push($('<span>').click(function() {
        var k, star, _j, _k, _len;
        for (_j = 0, _len = stars.length; _j < _len; _j++) {
          star = stars[_j];
          star.removeClass('active');
        }
        for (k = _k = 0; 0 <= lj ? _k <= lj : _k >= lj; k = 0 <= lj ? ++_k : --_k) {
          stars[k].addClass('active');
        }
        return nearestStar(lj, $($(this).parents('tr')));
      }));
    };
    for (j = _i = 0; _i < 6; j = ++_i) {
      _fn();
    }
    return starspan.append(stars);
  };

  window.getNewRow = function() {
    var newRow;
    newRow = $('<tr>').append($('<td>').html('<select id="applianceType">\
				<option value="">Select appliance</option>\
				<option value="airconditioner">Air conditioner</option>\
				<option value="clothesdryer">Clothes dryer</option>\
				<option value="computormonitors">Computor monitor</option>\
				<option value="dishwashers">Dishwasher</option>\
				<option value="fridgefreezer">Fridge/Freezer</option>\
				<option value="television">Television</option>\
			</select>')).append($('<td>').addClass('input').html(modelInput())).append($('<td>').append($('<a>').html(OR_USE_STARS).attr('href', "javascript:void(0);").addClass('use-stars-button').click(function() {
      var jthis;
      jthis = $(this);
      if (jthis.html() === OR_USE_MODEL) {
        jthis.html(OR_USE_STARS);
        return newRow.find('.input').html(modelInput());
      } else {
        jthis.html(OR_USE_MODEL);
        return newRow.find('.input').html(getStarInput());
      }
    }))).append($('<td>').html(0));
    return newRow;
  };

  addNewAppliance = function() {
    return $('.appliance-table').append(getNewRow());
  };

  $(document).ready(function() {
    addNewAppliance();
    return $('#addAppliance').click(addNewAppliance);
  });

  window.resultsReady = (function() {
    var res;
    res = false;
    return function(val) {
      res = val;
      if (res) {
        $('.navbox li').addClass('navigable');
      } else {
        $('.navbox li').removeClass('navigable');
      }
      return res;
    };
  })();

  window.getModel = function() {
    var cols, model, row, _i, _len, _ref;
    model = [];
    _ref = $('.appliances-table');
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      row = _ref[_i];
      cols = rows.find('td');
      model.append({
        type: $(cols[0]).val(),
        co2: parseInt($(cols[3]).html())
      });
    }
    return model;
  };

}).call(this);
